<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<org.eventb.core.machineFile org.eventb.core.configuration="org.eventb.core.fwd" version="5">
    <org.eventb.core.event name="'" org.eventb.core.convergence="0" org.eventb.core.extended="false" org.eventb.core.label="INITIALISATION">
        <org.eventb.core.action name="'" org.eventb.core.assignment="belief_base ≔ Initial_belief_base" org.eventb.core.label="act1"/>
        <org.eventb.core.action name="(" org.eventb.core.assignment="external_events ≔ Initial_external_event_set" org.eventb.core.label="act2"/>
        <org.eventb.core.action name=")" org.eventb.core.assignment="intentions ≔ ∅" org.eventb.core.label="act3"/>
        <org.eventb.core.action name="+" org.eventb.core.assignment="alreadytry ≔ ∅" org.eventb.core.label="act4"/>
    </org.eventb.core.event>
    <org.eventb.core.seesContext name="(" org.eventb.core.target="BDIcontext"/>
    <org.eventb.core.event name=")" org.eventb.core.convergence="0" org.eventb.core.extended="false" org.eventb.core.label="AddressExternalEvent">
        <org.eventb.core.guard name="'" org.eventb.core.label="grd1" org.eventb.core.predicate="event ↦ terms ∈ external_events"/>
        <org.eventb.core.parameter name="(" org.eventb.core.identifier="event"/>
        <org.eventb.core.action name="*" org.eventb.core.assignment="intentions ≔ intentions ∪ {∅ ↦ push({constructNDG({event} ↦ terms)},Empty)}" org.eventb.core.label="act1"/>
        <org.eventb.core.parameter name="+" org.eventb.core.identifier="terms"/>
        <org.eventb.core.action name="," org.eventb.core.assignment="external_events ≔ external_events ∖ {(event ↦ terms)} " org.eventb.core.label="act2"/>
    </org.eventb.core.event>
    <org.eventb.core.variable name="*" org.eventb.core.identifier="belief_base"/>
    <org.eventb.core.invariant name="+" org.eventb.core.label="inv1" org.eventb.core.predicate="belief_base ∈ ℙ(Belief_predicates × Terms)"/>
    <org.eventb.core.variable name="," org.eventb.core.identifier="external_events"/>
    <org.eventb.core.invariant name="-" org.eventb.core.label="inv2" org.eventb.core.predicate="external_events ∈ ℙ(Events × Terms)"/>
    <org.eventb.core.variable name="." org.eventb.core.identifier="intentions"/>
    <org.eventb.core.invariant name="/" org.eventb.core.label="inv3" org.eventb.core.predicate="intentions ∈ ℙ (ℙ(Events × Terms) × STACK(ℙ(AgentPrograms(Belief_predicates,None_belief_predicates,Terms)))) "/>
    <org.eventb.core.event name="6" org.eventb.core.convergence="0" org.eventb.core.extended="false" org.eventb.core.label="SelectRelevantPlans">
        <org.eventb.core.parameter name="'" org.eventb.core.identifier="event"/>
        <org.eventb.core.guard name="(" org.eventb.core.label="grd1" org.eventb.core.predicate="intention_stack ∈ ran(intentions)"/>
        <org.eventb.core.parameter name="*" org.eventb.core.identifier="terms"/>
        <org.eventb.core.parameter name="+" org.eventb.core.identifier="relevant_plans"/>
        <org.eventb.core.parameter name="," org.eventb.core.identifier="intention_stack"/>
        <org.eventb.core.guard name="4" org.eventb.core.label="grd2" org.eventb.core.predicate="notEmpty(intention_stack)"/>
        <org.eventb.core.guard name="-" org.eventb.core.label="grd3" org.eventb.core.predicate="pop(intention_stack) = {constructNDG({event} ↦ terms)}"/>
        <org.eventb.core.guard name="3" org.eventb.core.label="grd4" org.eventb.core.predicate="event ∈ Events"/>
        <org.eventb.core.guard name="2" org.eventb.core.comment="this event is not being addressed atm" org.eventb.core.label="grd5" org.eventb.core.predicate="{(event ↦ terms)} ∉ dom(intentions) "/>
        <org.eventb.core.guard name="/" org.eventb.core.label="grd6" org.eventb.core.predicate="relevant_plans ∈ ℙ(None_belief_predicates)"/>
        <org.eventb.core.guard name="." org.eventb.core.label="grd7" org.eventb.core.predicate="relevant_plans =dom(Plan_body(event))" org.eventb.core.theorem="true"/>
        <org.eventb.core.action name="0" org.eventb.core.assignment="intentions ≔ intentions ∪ {{(event ↦ terms)} ↦ push({constructNDG(relevant_plans ↦terms)},Empty)}" org.eventb.core.label="act1"/>
    </org.eventb.core.event>
    <org.eventb.core.event name="evt1" org.eventb.core.convergence="0" org.eventb.core.extended="false" org.eventb.core.label="SelectApplicablePlan">
        <org.eventb.core.guard name="0" org.eventb.core.comment="the mean-end relation is established after SelectRelevantPlans, hence no need forintention_stack ∈ ran(intentions) " org.eventb.core.label="grd1" org.eventb.core.predicate="{event ↦ terms}↦intention_stack ∈ intentions"/>
        <org.eventb.core.guard name="8" org.eventb.core.label="grd2" org.eventb.core.predicate="notEmpty(intention_stack)"/>
        <org.eventb.core.guard name="?" org.eventb.core.label="grd3" org.eventb.core.predicate="constructNDG(relevant_plans ↦ terms) ∈ pop(intention_stack)"/>
        <org.eventb.core.guard name="*" org.eventb.core.comment="type declaration for event parameter plan" org.eventb.core.label="grd4" org.eventb.core.predicate="plan ∈ Plan_library"/>
        <org.eventb.core.action name="6" org.eventb.core.assignment="alreadytry ≔alreadytry ∪{ event ↦terms↦applicable_plan_body_stack} " org.eventb.core.label="act1"/>
        <org.eventb.core.action name=")" org.eventb.core.assignment="intentions ≔ (intentions ∖ {{(event ↦ terms)} ↦ intention_stack}) ∪ {{(event ↦ terms)} ↦ applicable_plan_body_stack @ (next_stack(intention_stack))} " org.eventb.core.label="act2"/>
        <org.eventb.core.guard name="A" org.eventb.core.comment="relevant plan membership declaration for event parameter plan" org.eventb.core.label="grd5" org.eventb.core.predicate="plan ∈ relevant_plans"/>
        <org.eventb.core.guard name=";" org.eventb.core.comment="compute the applicable plan-body given the event, plan (i.e. identifier), current belief base, and the terms that are inherited from the event. The trick part to understand is that the plan body and its terms are defined together with terms for event, and terms in the context.    " org.eventb.core.label="grd6" org.eventb.core.predicate="applicable_plan_body_stack ∈ Plan_body(event)(plan)(belief_base↦terms)  "/>
        <org.eventb.core.guard name="9" org.eventb.core.comment="unlike in the propositional logic, we remove the selected applicable plan. In first order logic, even same plan with different grounding is different" org.eventb.core.label="real" org.eventb.core.predicate="event↦terms↦applicable_plan_body_stack∉alreadytry "/>
        <org.eventb.core.parameter name="," org.eventb.core.identifier="plan"/>
        <org.eventb.core.parameter name="4" org.eventb.core.identifier="event"/>
        <org.eventb.core.parameter name="&gt;" org.eventb.core.identifier="relevant_plans"/>
        <org.eventb.core.parameter name="@" org.eventb.core.identifier="terms"/>
        <org.eventb.core.parameter name="1" org.eventb.core.identifier="applicable_plan_body_stack"/>
        <org.eventb.core.parameter name="B" org.eventb.core.identifier="intention_stack"/>
    </org.eventb.core.event>
    <org.eventb.core.event name="1" org.eventb.core.convergence="0" org.eventb.core.extended="false" org.eventb.core.label="ExecuteAction">
        <org.eventb.core.parameter name="'" org.eventb.core.identifier="intention_stack"/>
        <org.eventb.core.parameter name="(" org.eventb.core.identifier="action_real"/>
        <org.eventb.core.guard name="6" org.eventb.core.label="grd1" org.eventb.core.predicate="({(event_real ↦ terms2)} ↦ intention_stack) ∈ intentions"/>
        <org.eventb.core.guard name="+" org.eventb.core.label="grd2" org.eventb.core.predicate="notEmpty(intention_stack)"/>
        <org.eventb.core.action name="-" org.eventb.core.assignment="belief_base ≔ next_belief_base" org.eventb.core.label="act1"/>
        <org.eventb.core.guard name="8" org.eventb.core.label="grd3" org.eventb.core.predicate="action_real∈Actions "/>
        <org.eventb.core.guard name="&gt;" org.eventb.core.label="grd4" org.eventb.core.predicate="pop(intention_stack) = {Constructor4NDG({action_real} ↦ terms1)}"/>
        <org.eventb.core.guard name="?" org.eventb.core.label="grd5" org.eventb.core.predicate="action_real↦terms1∈dom(Preconditions)"/>
        <org.eventb.core.guard name="1" org.eventb.core.label="grd6" org.eventb.core.predicate="Preconditions[{action_real ↦ terms1}] ⊆ belief_base"/>
        <org.eventb.core.action name="2" org.eventb.core.assignment="intentions ≔ next_intentions  " org.eventb.core.label="act2"/>
        <org.eventb.core.parameter name="4" org.eventb.core.identifier="event_real"/>
        <org.eventb.core.parameter name=")" org.eventb.core.identifier="terms1"/>
        <org.eventb.core.parameter name="5" org.eventb.core.identifier="terms2"/>
        <org.eventb.core.parameter name="9" org.eventb.core.identifier="next_intentions"/>
        <org.eventb.core.guard name=":" org.eventb.core.label="grd7" org.eventb.core.predicate="next_intentions=(intentions ∖ {({(event_real ↦ terms2)} ↦ intention_stack)}) ∪  {({(event_real ↦ terms2)} ↦ next_stack(intention_stack))} "/>
        <org.eventb.core.parameter name=";" org.eventb.core.identifier="next_belief_base"/>
        <org.eventb.core.guard name="=" org.eventb.core.label="grd8" org.eventb.core.predicate="next_belief_base=(belief_base ∖ Deletion_sets[{action_real ↦ terms1}]) ∪ Addition_sets[{action_real ↦ terms1}]"/>
    </org.eventb.core.event>
    <org.eventb.core.variable name="3" org.eventb.core.identifier="alreadytry"/>
    <org.eventb.core.invariant name="5" org.eventb.core.label="inv4" org.eventb.core.predicate="alreadytry ∈ (Events × Terms) ↔ STACK(ℙ(AgentPrograms(Belief_predicates,None_belief_predicates,Terms)))"/>
    <org.eventb.core.event name="7" org.eventb.core.convergence="0" org.eventb.core.extended="false" org.eventb.core.label="FailureRecoveryBlockedAction">
        <org.eventb.core.parameter name="'" org.eventb.core.identifier="intention_stack"/>
        <org.eventb.core.guard name="4" org.eventb.core.label="grd1" org.eventb.core.predicate="({(event_real ↦ terms2)} ↦ intention_stack) ∈ intentions"/>
        <org.eventb.core.guard name="(" org.eventb.core.label="grd2" org.eventb.core.predicate="action_real∈Actions"/>
        <org.eventb.core.action name=")" org.eventb.core.assignment="intentions ≔ (intentions ∖ {({(event_real ↦ terms2)} ↦ intention_stack)}) ∪  {({(event_real ↦ terms2)} ↦ push({Constructor4NDG(dom(Plan_body(event_real)) ↦ terms2)},Empty))}   " org.eventb.core.label="act1"/>
        <org.eventb.core.parameter name="*" org.eventb.core.identifier="action_real"/>
        <org.eventb.core.parameter name="+" org.eventb.core.identifier="event_real"/>
        <org.eventb.core.parameter name="-" org.eventb.core.identifier="terms1"/>
        <org.eventb.core.parameter name="." org.eventb.core.identifier="terms2"/>
        <org.eventb.core.guard name="5" org.eventb.core.label="grd3" org.eventb.core.predicate="notEmpty(intention_stack)"/>
        <org.eventb.core.guard name="1" org.eventb.core.label="grd4" org.eventb.core.predicate="pop(intention_stack) = {Constructor4NDG({action_real} ↦ terms1)}"/>
        <org.eventb.core.guard name="2" org.eventb.core.label="grd5" org.eventb.core.predicate="Preconditions[{action_real ↦ terms1}] ⊈ belief_base"/>
        <org.eventb.core.guard name="3" org.eventb.core.label="grd6" org.eventb.core.predicate="(event_real ↦ terms2) ∈ Events × Terms "/>
    </org.eventb.core.event>
    <org.eventb.core.event name="evt7" org.eventb.core.convergence="0" org.eventb.core.extended="false" org.eventb.core.label="evt1">
        <org.eventb.core.guard name="'" org.eventb.core.label="grd1" org.eventb.core.predicate="dgp ∈ Declarative_goal_programs"/>
        <org.eventb.core.guard name="(" org.eventb.core.label="grd2" org.eventb.core.predicate="SuccessConditions(DGPtoDG(dgp)) ⊈ belief_base"/>
        <org.eventb.core.parameter name=")" org.eventb.core.identifier="dgp"/>
    </org.eventb.core.event>
</org.eventb.core.machineFile>
